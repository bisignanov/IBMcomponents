import{w as E,u as Ye,a as $,c as k,_ as H,d as Ze,s as et,D as me,E as tt,S as nt,x as st,i as lt}from"./useMergedRefs-CY5AfkP4.js";import{u as pe,L as M,a as ot}from"./index-DCRLsKDD.js";import{i as G}from"./index-n5c_F1iv.js";import{P as t}from"./index-Dk74W0Oi.js";import{r as c,R as i}from"./index-BwDkhjyp.js";import{m as rt}from"./mergeRefs-CTUecegF.js";import{F as it}from"./FormContext-C7kRVu4t.js";import{n as at}from"./settings-B0yoEqB-.js";import{W as ct,a as dt}from"./bucket-18-CV2-K6tq.js";const ut={compareItems:t.func,sortItems:t.func},mt=(l,a,s)=>{let{locale:o}=s;return l.localeCompare(a,o,{numeric:!0})},pt=(l,a)=>{let{selectedItems:s=[],itemToString:o,compareItems:d,locale:u="en"}=a;return l.sort((p,C)=>{const S=s.includes(p),m=s.includes(C);return S&&!m?-1:m&&!S?1:d(o(p),o(C),{locale:u})})};function z(l){let{isControlled:a,isMounted:s,onChangeHandlerControlled:o,onChangeHandlerUncontrolled:d,selectedItems:u}=l;a?s&&o&&o({selectedItems:u}):d(u)}function ht(l){let{disabled:a,onChange:s,initialSelectedItems:o=[],selectedItems:d}=l;const u=c.useRef(!1),p=c.useRef(s),[C,S]=c.useState(o),m=!!d,x=m?d:C,B=c.useCallback(h=>{if(a)return;let D;x.forEach((L,U)=>{G(L,h)&&(D=U)});let _;if(D===void 0){_=x.concat(h),z({isControlled:m,isMounted:u.current,onChangeHandlerControlled:p.current,onChangeHandlerUncontrolled:S,selectedItems:_});return}_=he(x,D),z({isControlled:m,isMounted:u.current,onChangeHandlerControlled:p.current,onChangeHandlerUncontrolled:S,selectedItems:_})},[a,m,x]),K=c.useCallback(()=>{a||z({isControlled:m,isMounted:u.current,onChangeHandlerControlled:p.current,onChangeHandlerUncontrolled:S,selectedItems:[]})},[a,m]);return c.useEffect(()=>{p.current=s},[s]),c.useEffect(()=>{u.current&&p.current&&!m&&p.current({selectedItems:x})},[m,x]),c.useEffect(()=>(u.current=!0,()=>{u.current=!1}),[]),{selectedItems:x,onItemChange:B,clearSelection:K}}class ft extends i.Component{constructor(a){super(a),E(this,"internalSetState",(s,o)=>this.setState(s,()=>{o&&o(),this.props.onChange&&this.props.onChange(this.state)})),E(this,"handleClearSelection",()=>{this.props.disabled||this.internalSetState({selectedItems:[]})}),E(this,"handleSelectItem",s=>{this.internalSetState(o=>({selectedItems:o.selectedItems.concat(s)}))}),E(this,"handleRemoveItem",s=>{this.internalSetState(o=>({selectedItems:he(o.selectedItems,s)}))}),E(this,"handleOnItemChange",s=>{if(this.props.disabled)return;const{selectedItems:o}=this.state;let d;if(o.forEach((u,p)=>{G(u,s)&&(d=p)}),d===void 0){this.handleSelectItem(s);return}this.handleRemoveItem(d)}),this.state={selectedItems:a.initialSelectedItems}}render(){const{children:a,render:s}=this.props,{selectedItems:o}=this.state,d={selectedItems:o,onItemChange:this.handleOnItemChange,clearSelection:this.handleClearSelection};return s!==void 0?s(d):a!==void 0?a(d):null}}E(ft,"propTypes",{children:t.func,disabled:t.bool,initialSelectedItems:t.array.isRequired,onChange:t.func,render:t.func});const he=(l,a)=>{const s=l.slice();return s.splice(a,1),s},gt=et(),{ItemClick:It,ToggleButtonBlur:bt,ToggleButtonKeyDownArrowDown:xt,ToggleButtonKeyDownArrowUp:St,ToggleButtonKeyDownEnter:yt,ToggleButtonKeyDownEscape:Ct,ToggleButtonKeyDownSpaceButton:wt,ItemMouseMove:_t,MenuMouseLeave:vt,ToggleButtonClick:Tt,ToggleButtonKeyDownPageDown:$t,ToggleButtonKeyDownPageUp:Et,FunctionSetHighlightedIndex:Dt}=pe.stateChangeTypes,Ot=l=>typeof l=="string"?l:typeof l=="number"?`${l}`:l!==null&&typeof l=="object"&&"label"in l&&typeof l.label=="string"?l.label:"",fe=i.forwardRef((l,a)=>{var ue;let{className:s,id:o,items:d,itemToElement:u,itemToString:p=Ot,titleText:C=!1,hideLabel:S,helperText:m,label:x,type:B="default",size:K,disabled:h=!1,initialSelectedItems:D=[],sortItems:_=pt,compareItems:L=mt,clearSelectionText:U="To clear selection, press Delete or Backspace",clearAnnouncement:ge="all items have been cleared",clearSelectionDescription:Ie="Total items selected: ",light:be,invalid:f,invalidText:xe,warn:A,warnText:Se,useTitleInItem:ye,translateWithId:V,downshiftProps:Ce,open:O=!1,selectionFeedback:J="top-after-reopen",onChange:we,onMenuChange:Q,direction:_e="bottom",selectedItems:ve,readOnly:P,locale:Te="en",slug:F}=l;const n=Ye(),{isFluid:N}=c.useContext(it),{current:X}=c.useRef(gt()),[$e,Y]=c.useState(!1),[Z,ee]=c.useState(!1),[g,Ee]=c.useState(O||!1),[De,Oe]=c.useState(O),[Pe,ke]=c.useState([]),[Me,te]=c.useState(!1),{selectedItems:W,onItemChange:ne,clearSelection:se}=ht({disabled:h,initialSelectedItems:D,onChange:we,selectedItems:ve}),le=c.useMemo(()=>d.filter(e=>{if(typeof e=="object"&&e!==null){for(const b in e)if(Object.hasOwn(e,b)&&e[b]===void 0)return!1}return!0}),[d]),Be={...Ce,stateReducer:Ge,isOpen:g,itemToString:e=>Array.isArray(e)&&e.map(function(b){return p(b)}).join(", ")||"",selectedItem:W,items:le,isItemDisabled(e,b){return e.disabled}},{getToggleButtonProps:Ae,getLabelProps:Fe,getMenuProps:Ne,getItemProps:Re,selectedItem:He,highlightedIndex:Ke,setHighlightedIndex:oe}=pe(Be),re=Ae({onFocus:()=>{ee(!0)},onBlur:()=>{ee(!1)},onKeyDown:e=>{h||(($(e,me)||$(e,tt))&&!g&&(se(),e.stopPropagation()),!g&&$(e,me)&&I.length>0&&te(!0),($(e,nt)||$(e,st)||$(e,lt))&&!g&&(oe(0),te(!1),R(!0)))}}),q=rt(re.ref,a),I=He,R=e=>{Ee(e),Q&&Q(e)};De!==O&&(R(O),Oe(O));const w=B==="inline",ie=!f&&A,Le=k(`${n}--multi-select__wrapper`,`${n}--list-box__wrapper`,s,{[`${n}--multi-select__wrapper--inline`]:w,[`${n}--list-box__wrapper--inline`]:w,[`${n}--multi-select__wrapper--inline--invalid`]:w&&f,[`${n}--list-box__wrapper--inline--invalid`]:w&&f,[`${n}--list-box__wrapper--fluid--invalid`]:N&&f,[`${n}--list-box__wrapper--fluid--focus`]:!g&&N&&$e,[`${n}--list-box__wrapper--slug`]:F}),Ue=k(`${n}--label`,{[`${n}--label--disabled`]:h,[`${n}--visually-hidden`]:S}),ae=m?`multiselect-helper-text-${X}`:void 0,We=`multiselect-field-label-${X}`,qe=k(`${n}--form__helper-text`,{[`${n}--form__helper-text--disabled`]:h}),je=k(`${n}--multi-select`,{[`${n}--multi-select--invalid`]:f,[`${n}--multi-select--invalid--focused`]:f&&Z,[`${n}--multi-select--warning`]:ie,[`${n}--multi-select--inline`]:w,[`${n}--multi-select--selected`]:I&&I.length>0,[`${n}--list-box--up`]:_e==="top",[`${n}--multi-select--readonly`]:P}),ze=u,j={selectedItems:W,itemToString:p,compareItems:L,locale:Te};J==="fixed"?j.selectedItems=[]:J==="top-after-reopen"&&(j.selectedItems=Pe);function Ge(e,b){const{changes:r,props:y,type:v}=b,{highlightedIndex:T}=r;switch(r.isOpen&&!g&&ke(W),v){case wt:case yt:if(r.selectedItem===void 0||Array.isArray(r.selectedItem))break;return ne(r.selectedItem),{...r,highlightedIndex:e.highlightedIndex};case bt:case Ct:R(!1);break;case Tt:return R(r.isOpen||!1),{...r,highlightedIndex:0};case It:return oe(r.selectedItem),ne(r.selectedItem),{...r,highlightedIndex:e.highlightedIndex};case vt:return{...r,highlightedIndex:e.highlightedIndex};case Dt:return g?{...r,highlightedIndex:y.items.indexOf(T)}:{...r,highlightedIndex:0};case xt:case St:case $t:case Et:if(T>-1){const Xe=document.querySelectorAll(`li.${n}--list-box__menu-item[role="option"]`);y.scrollIntoView(Xe[T])}return T===-1?{...r,highlightedIndex:0}:r;case _t:return{...r,highlightedIndex:e.highlightedIndex}}return r}const Ve=k(`${n}--list-box__field--wrapper`,{[`${n}--list-box__field--wrapper--input-focused`]:Z}),ce=e=>{e.target.classList.contains(`${n}--tag__close-icon`)?Y(!1):Y(e.type==="focus")},Je=P?{onClick:e=>{e.preventDefault(),q.current!==void 0&&q.current.focus()},onKeyDown:e=>{["ArrowDown","ArrowUp"," ","Enter"].includes(e.key)&&e.preventDefault()}}:{};let de;F&&((ue=F.type)==null?void 0:ue.displayName)==="Slug"&&(de=i.cloneElement(F,{size:"mini"}));const Qe=I.length>0&&I.map(e=>e==null?void 0:e.text);return i.createElement("div",{className:Le},i.createElement("label",H({className:Ue},Fe()),C&&C,I.length>0&&i.createElement("span",{className:`${n}--visually-hidden`},Ie," ",I.length," ",Qe,",",U)),i.createElement(M,{onFocus:N?ce:void 0,onBlur:N?ce:void 0,type:B,size:K,className:je,disabled:h,light:be,invalid:f,invalidText:xe,warn:A,warnText:Se,isOpen:g,id:o},f&&i.createElement(ct,{className:`${n}--list-box__invalid-icon`}),ie&&i.createElement(dt,{className:`${n}--list-box__invalid-icon ${n}--list-box__invalid-icon--warning`}),i.createElement("div",{className:Ve},I.length>0&&i.createElement(M.Selection,{readOnly:P,clearSelection:!h&&!P?se:at,selectionCount:I.length,translateWithId:V,disabled:h}),i.createElement("button",H({type:"button",className:`${n}--list-box__field`,disabled:h,"aria-disabled":h||P,"aria-describedby":!w&&!f&&!A&&m?ae:void 0},re,{ref:q},Je),i.createElement("span",{id:We,className:`${n}--list-box__label`},x),i.createElement(M.MenuIcon,{isOpen:g,translateWithId:V})),de),i.createElement(M.Menu,Ne(),g&&_(le,j).map((e,b)=>{const r=I.filter(T=>G(T,e)).length>0,y=Re({item:e,"aria-selected":r}),v=p(e);return i.createElement(M.MenuItem,H({key:y.id,isActive:r,"aria-label":v,isHighlighted:Ke===b,title:v,disabled:y["aria-disabled"]},y),i.createElement("div",{className:`${n}--checkbox-wrapper`},i.createElement("span",{title:ye?v:void 0,className:`${n}--checkbox-label`,"data-contained-checkbox-state":r,id:`${y.id}__checkbox`},u?i.createElement(ze,H({key:y.id},e)):v)))})),Me&&i.createElement("span",{"aria-live":"assertive","aria-label":ge})),!w&&!f&&!A&&m&&i.createElement("div",{id:ae,className:qe},m))});fe.displayName="MultiSelect";fe.propTypes={...ut,className:t.string,clearSelectionDescription:t.string,clearSelectionText:t.string,compareItems:t.func,direction:t.oneOf(["top","bottom"]),disabled:t.bool,downshiftProps:t.object,helperText:t.node,hideLabel:t.bool,id:t.string.isRequired,initialSelectedItems:t.array,invalid:t.bool,invalidText:t.node,itemToElement:t.func,itemToString:t.func,items:t.array.isRequired,label:t.node.isRequired,light:Ze(t.bool),locale:t.string,onChange:t.func,onMenuChange:t.func,open:t.bool,readOnly:t.bool,selectedItems:t.array,selectionFeedback:t.oneOf(["top","fixed","top-after-reopen"]),size:ot,slug:t.node,sortItems:t.func,titleText:t.node,translateWithId:t.func,type:t.oneOf(["default","inline"]),useTitleInItem:t.bool,warn:t.bool,warnText:t.node};export{fe as M};
