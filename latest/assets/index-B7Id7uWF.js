import{u as H,c as R,_ as S,j as l,f as ce,P as V,d as q,s as ue}from"./deprecate-D9ms-jbM.js";import{P as t}from"./index-Dk74W0Oi.js";import{R as a,r as G}from"./index-BwDkhjyp.js";import{T as fe}from"./Text-_TFgs5hl.js";import{m as L,s as J,t as Q,a as pe,T as me,e as U,A as de,q as he,E as ge}from"./events-Bq7WR1mU.js";import{u as we}from"./index-gKY8typL.js";import{I as Z,n as I}from"./settings-BiUEFdm2.js";import{b as be,a as Oe}from"./useAttachedMenu-BGzc4N1_.js";import{d as ee}from"./bucket-11-S2aFzyL7.js";import{R as ve}from"./index-BONylQH5.js";import{c as $,g as ye}from"./_commonjsHelpers-BosuxZz1.js";import{s as _e,b as Ce,a as Me,w as Te}from"./wrapFocus-CuszVIVc.js";import{m as Re}from"./mergeRefs-CTUecegF.js";import{c as Ee}from"./createClassWrapper-EbB2Yi8H.js";const Ie=a.forwardRef(function(e,n){let{className:o,closeMenu:s,disabled:c=!1,handleOverflowMenuItemFocus:i,hasDivider:r=!1,href:d,isDelete:w=!1,index:v,itemText:h="Provide itemText",onClick:p=()=>{},onKeyDown:m=()=>{},requireTitle:f,title:b,wrapperClassName:y,..._}=e;const g=H();function M(T){L(T,J)&&(i==null||i({currentIndex:v,direction:1})),L(T,Q)&&(i==null||i({currentIndex:v,direction:-1}))}function O(T){p(T),s&&s()}const P=R(`${g}--overflow-menu-options__btn`,o),C=R(`${g}--overflow-menu-options__option`,{[`${g}--overflow-menu--divider`]:r,[`${g}--overflow-menu-options__option--danger`]:w,[`${g}--overflow-menu-options__option--disabled`]:c},y),D=d?"a":"button",z=typeof h!="string"?h:a.createElement("div",{className:`${g}--overflow-menu-options__option-content`},h);return a.createElement(fe,{as:"li",className:C,role:"none"},a.createElement(D,S({className:P,disabled:c,href:d,onClick:O,onKeyDown:T=>{M(T),m(T)},role:"menuitem",ref:n,tabIndex:-1,title:f?b||h:void 0},_),z))});Ie.propTypes={className:t.string,closeMenu:t.func,disabled:t.bool,handleOverflowMenuItemFocus:t.func,hasDivider:t.bool,href:t.string,index:t.number,isDelete:t.bool,itemText:t.node.isRequired,onBlur:t.func,onClick:t.func,onFocus:t.func,onKeyDown:t.func,onKeyUp:t.func,onMouseDown:t.func,onMouseEnter:t.func,onMouseLeave:t.func,onMouseUp:t.func,requireTitle:t.bool,title:t.string,wrapperClassName:t.string};const X="md",te=a.forwardRef(function(e,n){let{children:o,className:s,label:c="Options",renderIcon:i=ee,size:r=X,menuAlignment:d="bottom-start",tooltipAlignment:w,...v}=e;const h=pe("overflowmenu"),p=H(),m=G.useRef(null),{open:f,x:b,y,handleClick:_,handleMousedown:g,handleClose:M}=be(m);function O(){m.current&&_()}const P=R(s,`${p}--overflow-menu__container`),C=R(`${p}--overflow-menu__${d}`),D=R(`${p}--overflow-menu`,{[`${p}--overflow-menu--open`]:f},r!==X&&`${p}--overflow-menu--${r}`);return a.createElement("div",S({},v,{className:P,"aria-owns":f?h:null,ref:n}),a.createElement(Z,{"aria-controls":f?h:null,"aria-haspopup":!0,"aria-expanded":f,className:D,onClick:O,onMouseDown:g,ref:m,label:c,align:w},a.createElement(i,{className:`${p}--overflow-menu__icon`})),a.createElement(Oe,{containerRef:m,menuAlignment:d,className:C,id:h,size:r,open:f,onClose:M,x:b,y,label:c},o))});te.propTypes={children:t.node,className:t.string,label:t.string,menuAlignment:t.oneOf(["top-start","top-end","bottom-start","bottom-end"]),renderIcon:t.oneOfType([t.func,t.object]),size:t.oneOf(["sm","md","lg"]),tooltipAlignment:t.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","left","right"])};class N extends a.Component{static getEventTarget(e){return e.composed&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target}constructor(e){super(e),this.handleRef=this.handleRef.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this)}componentDidMount(){document.addEventListener("click",this.handleDocumentClick)}componentWillUnmount(){document.removeEventListener("click",this.handleDocumentClick)}handleDocumentClick(e){this.element&&this.element.contains&&!this.element.contains(N.getEventTarget(e))&&this.props.onClickOutside(e)}handleRef(e){const{children:n}=this.props;this.element=e,n.ref&&typeof n.ref=="function"&&n.ref(e)}render(){return a.cloneElement(this.props.children,{ref:this.handleRef})}}l(N,"propTypes",{children:t.element.isRequired,onClickOutside:t.func.isRequired});var xe=typeof self=="object"&&self.self===self&&self||typeof $=="object"&&$.global===$&&$||$;const x=ye(xe),Pe=function(){const e=[];let n=!1;function o(){e.forEach(i=>{i()}),n=!1}function s(){n||(n=!0,x.requestAnimationFrame(o))}function c(i){i&&e.indexOf(i)<0&&e.push(i)}return{add:i=>(e.length||x.addEventListener("resize",s),c(i),{release(){const r=e.indexOf(i);r>=0&&e.splice(r,1)}})}}();var De=Pe;const ne="left",B="top",oe="right",E="bottom",$e=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return typeof u!=typeof e?!0:Object(e)===e&&typeof e!="function"?u.top!==e.top||u.left!==e.left:u!==e},Ne=u=>{let{menuSize:e,refPosition:n={},offset:o={},direction:s=E,scrollX:c=0,scrollY:i=0,container:r}=u;const{left:d=0,top:w=0,right:v=0,bottom:h=0}=n,p=r.position!=="static"?0:c,m=r.position!=="static"?0:i,f={top:r.position!=="static"?r.rect.top:0,left:r.position!=="static"?r.rect.left:0},{width:b,height:y}=e,{top:_=0,left:g=0}=o,M=(d+v)/2,O=(w+h)/2;return{[ne]:()=>({left:d-b+p-g-f.left,top:O-y/2+m+_-9-f.top}),[B]:()=>({left:M-b/2+p+g-f.left,top:w-y+m-_-f.top}),[oe]:()=>({left:v+p+g-f.left,top:O-y/2+m+_+3-f.top}),[E]:()=>({left:M-b/2+p+g-f.left,top:h+m+_-f.top})}[s]()};class W extends a.Component{constructor(){var e;super(...arguments),e=this,l(this,"_placeInProgress",!1),l(this,"state",{floatingPosition:void 0}),l(this,"_menuContainer",null),l(this,"_menuBody",null),l(this,"startSentinel",a.createRef()),l(this,"endSentinel",a.createRef()),l(this,"_updateMenuSize",function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const s=e._menuBody;if(!s)return;const{menuOffset:c={},menuDirection:i}=n,{menuOffset:r={},menuDirection:d=E}=e.props;if($e(c,r)||i!==d||o){const{flipped:w,triggerRef:v,updateOrientation:h=null}=e.props,{current:p}=v,m=s.getBoundingClientRect(),f=p&&p.getBoundingClientRect(),b=typeof r!="function"?r:r(s,d,p,w);h&&h({menuSize:m,refPosition:f,direction:d,offset:b,scrollX:x.pageXOffset,scrollY:x.pageYOffset,container:{rect:e.props.target().getBoundingClientRect(),position:getComputedStyle(e.props.target()).position}}),(m.width>0&&m.height>0||!b)&&e.setState({floatingPosition:Ne({menuSize:m,refPosition:f,direction:d,offset:b,scrollX:x.pageXOffset,scrollY:x.pageYOffset,container:{rect:e.props.target().getBoundingClientRect(),position:getComputedStyle(e.props.target()).position}})},()=>{o||s.getBoundingClientRect()!==m&&e._updateMenuSize(e.props,!0)})}}),l(this,"_focusMenuContent",n=>{const o=n.querySelector(this.props.selectorPrimaryFocus||null),s=n.querySelector(_e),c=n.querySelector(Ce);(o||s||c||n).focus()}),l(this,"_menuRef",n=>{const{menuRef:o}=this.props;this._placeInProgress=!!n,o&&o(this._menuBody=n),n&&this._updateMenuSize()}),l(this,"_getChildrenWithProps",()=>{const{styles:n,children:o}=this.props,{floatingPosition:s}=this.state,c=s?{left:`${s.left}px`,top:`${s.top}px`,right:"auto"}:{visibility:"hidden",top:"0px"};return a.cloneElement(o,{ref:this._menuRef,style:{...n,...c,position:"absolute",opacity:1}})}),l(this,"handleBlur",n=>{let{target:o,relatedTarget:s}=n;if(s&&o){const{current:c}=this.startSentinel,{current:i}=this.endSentinel;Me({bodyNode:this._menuBody,startSentinelNode:c,endSentinelNode:i,currentActiveNode:s,oldActiveNode:o})}}),l(this,"handleKeyDown",n=>{L(n,me)&&this._menuBody&&Te({containerNode:this._menuBody,currentActiveNode:n.target,event:n})})}componentWillUnmount(){this.hResize.release()}componentDidMount(){this.hResize=De.add(()=>{this._updateMenuSize()})}componentDidUpdate(e){this._updateMenuSize(e);const{onPlace:n}=this.props;this._placeInProgress&&this.state.floatingPosition&&(this._menuBody&&!this._menuBody.contains(document.activeElement)&&this._focusMenuContent(this._menuBody),typeof n=="function"&&(n(this._menuBody),this._placeInProgress=!1))}render(){const{context:e}=this,n=ce("enable-experimental-focus-wrap-without-sentinels");if(typeof document<"u"){const{focusTrap:o,target:s}=this.props;return ve.createPortal(a.createElement("div",{onBlur:o&&!n?this.handleBlur:()=>{},onKeyDown:n?this.handleKeyDown:()=>{}},!n&&a.createElement("span",{ref:this.startSentinel,tabIndex:"0",role:"link",className:`${e}--visually-hidden`},"Focus sentinel"),this._getChildrenWithProps(),!n&&a.createElement("span",{ref:this.endSentinel,tabIndex:"0",role:"link",className:`${e}--visually-hidden`},"Focus sentinel")),s?s():document.body)}return null}}l(W,"contextType",V);l(W,"propTypes",{children:t.object,flipped:t.bool,focusTrap:t.bool,menuDirection:t.oneOf([ne,B,oe,E]),menuOffset:t.oneOfType([t.shape({top:t.number,left:t.number}),t.func]),menuRef:t.func,onPlace:t.func,selectorPrimaryFocus:t.string,styles:t.object,target:t.func,triggerRef:t.oneOfType([t.func,t.shape({current:t.any})]),updateOrientation:t.func});var Fe=W;const Se=ue(),Be=function(u){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return u.addEventListener(...n),{release(){return u.removeEventListener(...n),null}}},ke={[B]:"bottom",[E]:"top"},Y=(u,e,n,o)=>{const s=ke[e],{offsetWidth:c,offsetHeight:i}=u;switch(s){case"top":case"bottom":{const r=n?n.offsetWidth:0;return{left:(o?-1:1)*(c/2-r/2),top:0}}case"left":case"right":{const r=n?n.offsetHeight:0;return{left:0,top:(o?-1:1)*(i/2-r/2)}}}};let k=class extends G.Component{constructor(){super(...arguments),l(this,"state",{}),l(this,"instanceId",Se()),l(this,"_hFocusIn",null),l(this,"_hBlurTimeout",void 0),l(this,"_triggerRef",a.createRef()),l(this,"handleClick",e=>{const{onClick:n=I}=this.props;this.setState({click:!0}),e.stopPropagation(),(!this._menuBody||!this._menuBody.contains(e.target))&&(this.setState({open:!this.state.open}),n(e))}),l(this,"closeMenuAndFocus",()=>{let e=this.state.click,n=this.state.open;this.closeMenu(()=>{n&&!e&&this.focusMenuEl()})}),l(this,"closeMenuOnEscape",()=>{let e=this.state.open;this.closeMenu(()=>{e&&this.focusMenuEl()})}),l(this,"handleKeyPress",e=>{this.state.open&&U(e,[Q,de,J,he])&&e.preventDefault(),U(e,[ge])&&(this.closeMenuOnEscape(),e.stopPropagation())}),l(this,"handleClickOutside",e=>{this.state.open&&(!this._menuBody||!this._menuBody.contains(e.target))&&this.closeMenu()}),l(this,"closeMenu",e=>{const{onClose:n=I}=this.props;this.setState({open:!1},()=>{e&&e(),n()})}),l(this,"focusMenuEl",()=>{const{current:e}=this._triggerRef;e&&e.focus()}),l(this,"handleOverflowMenuItemFocus",e=>{let{currentIndex:n,direction:o}=e;const s=a.Children.toArray(this.props.children).reduce((r,d,w)=>(d.props.disabled||r.push(w),r),[]),c=(()=>{const r=s.indexOf(n)+o;switch(r){case-1:return s.length-1;case s.length:return 0;default:return r}})(),i=this[`overflowMenuItem${s[c]}`];i==null||i.focus()}),l(this,"_bindMenuBody",e=>{e||(this._menuBody=e),!e&&this._hFocusIn&&(this._hFocusIn=this._hFocusIn.release())}),l(this,"_handlePlace",e=>{const{onOpen:n=I}=this.props;if(e){this._menuBody=e;const o="onfocusin"in window,s=o?"focusin":"focus";this._hFocusIn=Be(e.ownerDocument,s,c=>{const i=N.getEventTarget(c),{current:r}=this._triggerRef;typeof i.matches=="function"&&!e.contains(i)&&r&&!i.matches(`.${this.context}--overflow-menu:first-child,.${this.context}--overflow-menu-options:first-child`)&&this.closeMenuAndFocus()},!o),n()}}),l(this,"_getTarget",()=>{const{current:e}=this._triggerRef;return e&&e.closest("[data-floating-menu-container]")||document.body})}componentDidUpdate(e,n){const{onClose:o=I}=this.props;!this.state.open&&n.open&&o()}componentDidMount(){this._triggerRef.current&&this.setState({hasMountedTrigger:!0})}static getDerivedStateFromProps(e,n){let{open:o}=e;const{prevOpen:s}=n;return s===o?null:{open:o,prevOpen:o}}componentWillUnmount(){typeof this._hBlurTimeout=="number"&&(clearTimeout(this._hBlurTimeout),this._hBlurTimeout=void 0)}render(){const e=this.context,{id:n,["aria-label"]:o=null,ariaLabel:s,children:c,iconDescription:i="Options",direction:r=E,flipped:d=!1,focusTrap:w=!0,menuOffset:v=Y,menuOffsetFlip:h=Y,iconClass:p,onClick:m=I,onOpen:f=I,selectorPrimaryFocus:b="[data-floating-menu-primary-focus]",renderIcon:y=ee,innerRef:_,menuOptionsClass:g,light:M,size:O="md",...P}=this.props,{open:C=!1}=this.state,D=R(this.props.className,`${e}--overflow-menu`,{[`${e}--overflow-menu--open`]:C,[`${e}--overflow-menu--light`]:M,[`${e}--overflow-menu--${O}`]:O}),z=R(g,`${e}--overflow-menu-options`,{[`${e}--overflow-menu--flip`]:this.props.flipped,[`${e}--overflow-menu-options--open`]:C,[`${e}--overflow-menu-options--light`]:M,[`${e}--overflow-menu-options--${O}`]:O}),T=R(`${e}--overflow-menu__icon`,p),se=a.Children.toArray(c).map((F,j)=>{var K;return a.cloneElement(F,{closeMenu:((K=F==null?void 0:F.props)==null?void 0:K.closeMenu)||this.closeMenuAndFocus,handleOverflowMenuItemFocus:this.handleOverflowMenuItemFocus,ref:ae=>{this[`overflowMenuItem${j}`]=ae},index:j})}),A=`overflow-menu-${this.instanceId}__menu-body`,ie=a.createElement("ul",{className:z,tabIndex:"-1",role:"menu","aria-label":o||s,onKeyDown:this.handleKeyPress,id:A},se),re=a.createElement(Fe,{focusTrap:w,triggerRef:this._triggerRef,menuDirection:r,menuOffset:d?h:v,menuRef:this._bindMenuBody,flipped:this.props.flipped,target:this._getTarget,onPlace:this._handlePlace,selectorPrimaryFocus:this.props.selectorPrimaryFocus},a.cloneElement(ie,{"data-floating-menu-direction":r})),le={className:T,"aria-label":i};return a.createElement(N,{onClickOutside:this.handleClickOutside},a.createElement("span",{className:`${e}--overflow-menu__wrapper`,"aria-owns":C?A:null},a.createElement(Z,S({},P,{type:"button","aria-haspopup":!0,"aria-expanded":C,"aria-controls":C?A:null,className:D,onClick:this.handleClick,id:n,ref:Re(this._triggerRef,_),size:O,label:i}),a.createElement(y,le)),C&&this.state.hasMountedTrigger&&re))}};l(k,"propTypes",{"aria-label":t.string,ariaLabel:q(t.string),children:t.node,className:t.string,direction:t.oneOf([B,E]),flipped:t.bool,focusTrap:t.bool,iconClass:t.string,iconDescription:t.string,id:t.string,light:q(t.bool),menuOffset:t.oneOfType([t.shape({top:t.number,left:t.number}),t.func]),menuOffsetFlip:t.oneOfType([t.shape({top:t.number,left:t.number}),t.func]),menuOptionsClass:t.string,onClick:t.func,onClose:t.func,onFocus:t.func,onKeyDown:t.func,onOpen:t.func,open:t.bool,renderIcon:t.oneOfType([t.func,t.object]),selectorPrimaryFocus:t.string,size:t.oneOf(["sm","md","lg"])});l(k,"contextType",V);(()=>{const u=(e,n)=>a.createElement(k,S({},e,{innerRef:n}));return u.displayName="OverflowMenu",a.forwardRef(u)})();const ze=Ee(k);function Ae(u){return we("enable-v12-overflowmenu")?a.createElement(te,u):a.createElement(ze,u)}Ae.displayName="OverflowMenu";export{Ae as O,Ie as a};
