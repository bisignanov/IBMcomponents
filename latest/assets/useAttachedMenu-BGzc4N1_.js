import{u as fe,c as de,_ as me}from"./deprecate-D9ms-jbM.js";import{P as n}from"./index-Dk74W0Oi.js";import{r,R as N}from"./index-BwDkhjyp.js";import{r as pe}from"./index-BONylQH5.js";import{u as he,m as M,E as xe,q as ye,t as be,s as ge}from"./events-Bq7WR1mU.js";const we={isRoot:!0,mode:"full",hasIcons:!1,size:null,items:[],requestCloseRoot:()=>{}};function Ce(c,d){switch(d.type){case"enableIcons":return{...c,hasIcons:!0};case"registerItem":return{...c,items:[...c.items,d.payload].filter(m=>m.ref.current!==null)}}}const Z=r.createContext({state:we,dispatch:c=>{}}),Re=N.createContext({direction:"ltr"});function ze(){return r.useContext(Re)}const O=8,Ee=r.forwardRef(function(d,m){let{children:w,className:P,containerRef:p,label:C,menuAlignment:i,mode:$="full",onClose:u,onOpen:R,open:l,size:z="sm",target:D=document.body,x:ee=0,y:te=0,...E}=d;const h=fe(),S=r.useRef(null),g=r.useContext(Z),f=g.state.isRoot;g.state.mode;const ne=f?z:g.state.size,[_,K]=r.useReducer(Ce,{...g.state,isRoot:!1,mode:$,size:z,requestCloseRoot:f?k:g.state.requestCloseRoot}),B=r.useMemo(()=>({state:_,dispatch:K}),[_,K]),o=r.useRef(null),oe=he([m,o]),[W,j]=r.useState([-1,-1]),x=B.state.items.filter(e=>!e.disabled&&e.ref.current);let y;if(p!=null&&p.current){const{width:e}=p.current.getBoundingClientRect();y=e}const{direction:se}=ze();function T(){S.current&&S.current.focus()}function re(){var e;if(o.current){S.current=document.activeElement;const t=le();((document==null?void 0:document.dir)==="rtl"||se==="rtl")&&!((e=E==null?void 0:E.id)!=null&&e.includes("MenuButton"))?(o.current.style.insetInlineStart="initial",o.current.style.insetInlineEnd=`${t[0]}px`):(o.current.style.insetInlineStart=`${t[0]}px`,o.current.style.insetInlineEnd="initial"),o.current.style.insetBlockStart=`${t[1]}px`,j(t),o.current.focus(),R&&R()}}function k(e){/^key/.test(e.type)?window.addEventListener("keyup",T,{once:!0}):e.type==="click"&&o.current?o.current.addEventListener("focusout",T,{once:!0}):T(),u&&u()}function ie(e){e.stopPropagation(),(M(e,xe)||!f&&M(e,ye))&&u?k(e):H(e)}function H(e){const t=x.findIndex(I=>I.ref.current.contains(document.activeElement));let s=t;t===-1?s=0:e&&(M(e,be)&&(s=s-1),M(e,ge)&&(s=s+1)),s<0&&(s=x.length-1),s>=x.length&&(s=0),s!==t&&x[s].ref.current.focus()}function ce(e){var t;l&&u&&f&&!((t=o.current)!=null&&t.contains(e.relatedTarget))&&k(e)}function U(e,t){if(!o.current)return;const{width:s,height:I}=o.current.getBoundingClientRect(),A=f?"vertical":"horizontal",a={x:{max:window.innerWidth,size:s,anchor:A==="horizontal"?e[1]:e[0],reversedAnchor:A==="horizontal"?e[0]:e[1],offset:0},y:{max:window.innerHeight,size:I,anchor:A==="horizontal"?e[0]:e[1],reversedAnchor:A==="horizontal"?e[1]:e[0],offset:f?0:4}};if(y&&y<a.x.size&&(i==="bottom"||i==="top")&&(a.x.size=y),y&&(i==="bottom-end"||i==="top-end")&&a.x.anchor>=87&&y<a.x.size){const F=a.x.anchor+a.x.reversedAnchor;a.x.anchor=a.x.anchor+F}const{max:J,size:v,anchor:L,reversedAnchor:Q,offset:q}=a[t],b=[J-O-v-L>=0?L-q:!1,Q-v>=0?Q-v+q:!1,J-O-v],X=i==="top"||i==="top-end"||i==="top-start";typeof b[0]=="number"&&X&&b[0]>=0&&!b[1]&&t==="y"?o.current.style.transform="translate(0)":X&&!b[0]&&t==="y"&&(b[0]=L-q);const Y=b.find(F=>F!==!1);return Y>=O?Y:O}function ue(e){return e!=null}function V(e){if(Array.isArray(e)){const t=e.filter(ue);return t.length===2?t:void 0}else return[e,e]}function le(){const e={x:V(ee),y:V(te)};return!e.x||!e.y?[-1,-1]:[U(e.x,"x")??-1,U(e.y,"y")??-1]}r.useEffect(()=>{l&&x.length>0&&H()},[l,x]),r.useEffect(()=>{l?re():j([-1,-1])},[l]);const ae=de(P,`${h}--menu`,`${h}--menu--${ne}`,{[`${h}--menu--box-shadow-top`]:i&&i.slice(0,3)==="top",[`${h}--menu--open`]:l,[`${h}--menu--shown`]:W[0]>=0&&W[1]>=0,[`${h}--menu--with-icons`]:B.state.hasIcons}),G=N.createElement(Z.Provider,{value:B},N.createElement("ul",me({},E,{className:ae,role:"menu",ref:oe,"aria-label":C,tabIndex:-1,onKeyDown:ie,onBlur:ce}),w));return f?l&&pe.createPortal(G,D)||null:G});Ee.propTypes={children:n.node,className:n.string,label:n.string,menuAlignment:n.string,mode:n.oneOf(["full","basic"]),onClose:n.func,onOpen:n.func,open:n.bool,size:n.oneOf(["xs","sm","md","lg"]),target:n.object,x:n.oneOfType([n.number,n.arrayOf(n.number)]),y:n.oneOfType([n.number,n.arrayOf(n.number)])};function Pe(c){const[d,m]=r.useState(!1),[w,P]=r.useState([[-1,-1],[-1,-1]]);function p(){const u=(c==null?void 0:c.current)||c;if(u){const{left:R,top:l,right:z,bottom:D}=u.getBoundingClientRect();P([[R,z],[l,D]])}m(!0)}function C(){m(!1)}function i(){d?C():p()}function $(u){u.preventDefault()}return{open:d,x:w[0],y:w[1],handleClick:i,handleMousedown:$,handleClose:C}}export{Z as M,Ee as a,Pe as b,ze as u};
