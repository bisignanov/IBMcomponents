import{j as D,d as Ye,u as Ze,c as M,_ as K,s as et}from"./deprecate-D9ms-jbM.js";import{a as tt,u as he,L as B}from"./index-JVWw4PeO.js";import{i as z}from"./index-n5c_F1iv.js";import{P as t}from"./index-Dk74W0Oi.js";import{r as c,R as i}from"./index-BwDkhjyp.js";import{m as nt}from"./mergeRefs-CTUecegF.js";import{F as st}from"./FormContext-C7kRVu4t.js";import{n as lt}from"./settings-DrdbGLhD.js";import{m as E,D as me,E as ot,S as rt,s as it,f as at}from"./events-Bq7WR1mU.js";import{W as ct,a as dt}from"./bucket-17-CArjO86K.js";const ut={compareItems:t.func,sortItems:t.func},mt=(l,a,s)=>{let{locale:o}=s;return l.localeCompare(a,o,{numeric:!0})},pt=(l,a)=>{let{selectedItems:s=[],itemToString:o,compareItems:d,locale:u="en"}=a;return l.sort((p,y)=>{const C=s.includes(p),m=s.includes(y);return C&&!m?-1:m&&!C?1:d(o(p),o(y),{locale:u})})};function pe(l){let{isControlled:a,isMounted:s,onChangeHandlerControlled:o,onChangeHandlerUncontrolled:d,selectedItems:u}=l;a?s&&o&&o({selectedItems:u}):d(u)}function ht(l){let{disabled:a,onChange:s,initialSelectedItems:o=[],selectedItems:d}=l;const u=c.useRef(!1),p=c.useRef(s),[y,C]=c.useState(o),m=!!d,[x,w]=c.useState(m?d:y);c.useEffect(()=>{pe({isControlled:m,isMounted:u.current,onChangeHandlerControlled:p.current,onChangeHandlerUncontrolled:C,selectedItems:x})},[m,u,x]);const L=c.useCallback(A=>{if(a)return;let O;if(x.forEach((_,W)=>{z(_,A)&&(O=W)}),O===void 0){w(_=>_.concat(A));return}w(_=>fe(_,O))},[a,x]),h=c.useCallback(()=>{a||pe({isControlled:m,isMounted:u.current,onChangeHandlerControlled:p.current,onChangeHandlerUncontrolled:C,selectedItems:w([])})},[a,m]);return c.useEffect(()=>{p.current=s},[s]),c.useEffect(()=>{u.current&&p.current&&!m&&p.current({selectedItems:x})},[m,x]),c.useEffect(()=>(u.current=!0,()=>{u.current=!1}),[]),{selectedItems:x,onItemChange:L,clearSelection:h}}class ft extends i.Component{constructor(a){super(a),D(this,"internalSetState",(s,o)=>this.setState(s,()=>{o&&o(),this.props.onChange&&this.props.onChange(this.state)})),D(this,"handleClearSelection",()=>{this.props.disabled||this.internalSetState({selectedItems:[]})}),D(this,"handleSelectItem",s=>{this.internalSetState(o=>({selectedItems:o.selectedItems.concat(s)}))}),D(this,"handleRemoveItem",s=>{this.internalSetState(o=>({selectedItems:fe(o.selectedItems,s)}))}),D(this,"handleOnItemChange",s=>{if(this.props.disabled)return;const{selectedItems:o}=this.state;let d;if(o.forEach((u,p)=>{z(u,s)&&(d=p)}),d===void 0){this.handleSelectItem(s);return}this.handleRemoveItem(d)}),this.state={selectedItems:a.initialSelectedItems}}render(){const{children:a,render:s}=this.props,{selectedItems:o}=this.state,d={selectedItems:o,onItemChange:this.handleOnItemChange,clearSelection:this.handleClearSelection};return s!==void 0?s(d):a!==void 0?a(d):null}}D(ft,"propTypes",{children:t.func,disabled:t.bool,initialSelectedItems:t.array.isRequired,onChange:t.func,render:t.func});const fe=(l,a)=>{const s=l.slice();return s.splice(a,1),s},gt=et(),{ItemClick:It,ToggleButtonBlur:bt,ToggleButtonKeyDownArrowDown:xt,ToggleButtonKeyDownArrowUp:St,ToggleButtonKeyDownEnter:yt,ToggleButtonKeyDownEscape:Ct,ToggleButtonKeyDownSpaceButton:_t,ItemMouseMove:vt,MenuMouseLeave:wt,ToggleButtonClick:Tt,ToggleButtonKeyDownPageDown:$t,ToggleButtonKeyDownPageUp:Et,FunctionSetHighlightedIndex:Dt}=he.stateChangeTypes,Ot=l=>typeof l=="string"?l:typeof l=="number"?`${l}`:l!==null&&typeof l=="object"&&"label"in l&&typeof l.label=="string"?l.label:"",G=i.forwardRef((l,a)=>{var ue;let{className:s,id:o,items:d,itemToElement:u,itemToString:p=Ot,titleText:y=!1,hideLabel:C,helperText:m,label:x,type:w="default",size:L,disabled:h=!1,initialSelectedItems:A=[],sortItems:O=pt,compareItems:_=mt,clearSelectionText:W="To clear selection, press Delete or Backspace",clearAnnouncement:ge="all items have been cleared",clearSelectionDescription:Ie="Total items selected: ",light:be,invalid:f,invalidText:xe,warn:F,warnText:Se,useTitleInItem:ye,translateWithId:V,downshiftProps:Ce,open:P=!1,selectionFeedback:J="top-after-reopen",onChange:_e,onMenuChange:Q,direction:ve="bottom",selectedItems:we,readOnly:k,locale:Te="en",slug:N}=l;const n=Ze(),{isFluid:R}=c.useContext(st),{current:X}=c.useRef(gt()),[$e,Y]=c.useState(!1),[Z,ee]=c.useState(!1),[g,Ee]=c.useState(P||!1),[De,Oe]=c.useState(P),[Pe,ke]=c.useState([]),[Me,te]=c.useState(!1),{selectedItems:U,onItemChange:ne,clearSelection:se}=ht({disabled:h,initialSelectedItems:A,onChange:_e,selectedItems:we}),le=c.useMemo(()=>d.filter(e=>{if(typeof e=="object"&&e!==null){for(const b in e)if(Object.hasOwn(e,b)&&e[b]===void 0)return!1}return!0}),[d]),Be={...Ce,stateReducer:Ge,isOpen:g,itemToString:e=>Array.isArray(e)&&e.map(function(b){return p(b)}).join(", ")||"",selectedItem:U,items:le,isItemDisabled(e,b){return e.disabled}},{getToggleButtonProps:Ae,getLabelProps:Fe,getMenuProps:Ne,getItemProps:Re,selectedItem:He,highlightedIndex:Ke,setHighlightedIndex:oe}=he(Be),re=Ae({onFocus:()=>{ee(!0)},onBlur:()=>{ee(!1)},onKeyDown:e=>{h||((E(e,me)||E(e,ot))&&!g&&(se(),e.stopPropagation()),!g&&E(e,me)&&I.length>0&&te(!0),(E(e,rt)||E(e,it)||E(e,at))&&!g&&(oe(0),te(!1),H(!0)))}}),j=nt(re.ref,a),I=He,H=e=>{Ee(e),Q&&Q(e)};De!==P&&(H(P),Oe(P));const v=w==="inline",ie=!f&&F,Le=M(`${n}--multi-select__wrapper`,`${n}--list-box__wrapper`,s,{[`${n}--multi-select__wrapper--inline`]:v,[`${n}--list-box__wrapper--inline`]:v,[`${n}--multi-select__wrapper--inline--invalid`]:v&&f,[`${n}--list-box__wrapper--inline--invalid`]:v&&f,[`${n}--list-box__wrapper--fluid--invalid`]:R&&f,[`${n}--list-box__wrapper--fluid--focus`]:!g&&R&&$e,[`${n}--list-box__wrapper--slug`]:N}),We=M(`${n}--label`,{[`${n}--label--disabled`]:h,[`${n}--visually-hidden`]:C}),ae=m?`multiselect-helper-text-${X}`:void 0,Ue=`multiselect-field-label-${X}`,je=M(`${n}--form__helper-text`,{[`${n}--form__helper-text--disabled`]:h}),qe=M(`${n}--multi-select`,{[`${n}--multi-select--invalid`]:f,[`${n}--multi-select--invalid--focused`]:f&&Z,[`${n}--multi-select--warning`]:ie,[`${n}--multi-select--inline`]:v,[`${n}--multi-select--selected`]:I&&I.length>0,[`${n}--list-box--up`]:ve==="top",[`${n}--multi-select--readonly`]:k}),ze=u,q={selectedItems:U,itemToString:p,compareItems:_,locale:Te};J==="fixed"?q.selectedItems=[]:J==="top-after-reopen"&&(q.selectedItems=Pe);function Ge(e,b){const{changes:r,props:S,type:T}=b,{highlightedIndex:$}=r;switch(r.isOpen&&!g&&ke(U),T){case _t:case yt:if(r.selectedItem===void 0||Array.isArray(r.selectedItem))break;return ne(r.selectedItem),{...r,highlightedIndex:e.highlightedIndex};case bt:case Ct:H(!1);break;case Tt:return H(r.isOpen||!1),{...r,highlightedIndex:0};case It:return oe(r.selectedItem),ne(r.selectedItem),{...r,highlightedIndex:e.highlightedIndex};case wt:return{...r,highlightedIndex:e.highlightedIndex};case Dt:return g?{...r,highlightedIndex:S.items.indexOf($)}:{...r,highlightedIndex:0};case xt:case St:case $t:case Et:if($>-1){const Xe=document.querySelectorAll(`li.${n}--list-box__menu-item[role="option"]`);S.scrollIntoView(Xe[$])}return $===-1?{...r,highlightedIndex:0}:r;case vt:return{...r,highlightedIndex:e.highlightedIndex}}return r}const Ve=M(`${n}--list-box__field--wrapper`,{[`${n}--list-box__field--wrapper--input-focused`]:Z}),ce=e=>{e.target.classList.contains(`${n}--tag__close-icon`)?Y(!1):Y(e.type==="focus")},Je=k?{onClick:e=>{e.preventDefault(),j.current!==void 0&&j.current.focus()},onKeyDown:e=>{["ArrowDown","ArrowUp"," ","Enter"].includes(e.key)&&e.preventDefault()}}:{};let de;N&&((ue=N.type)==null?void 0:ue.displayName)==="Slug"&&(de=i.cloneElement(N,{size:"mini"}));const Qe=I.length>0&&I.map(e=>e==null?void 0:e.text);return i.createElement("div",{className:Le},i.createElement("label",K({className:We},Fe()),y&&y,I.length>0&&i.createElement("span",{className:`${n}--visually-hidden`},Ie," ",I.length," ",Qe,",",W)),i.createElement(B,{onFocus:R?ce:void 0,onBlur:R?ce:void 0,type:w,size:L,className:qe,disabled:h,light:be,invalid:f,invalidText:xe,warn:F,warnText:Se,isOpen:g,id:o},f&&i.createElement(ct,{className:`${n}--list-box__invalid-icon`}),ie&&i.createElement(dt,{className:`${n}--list-box__invalid-icon ${n}--list-box__invalid-icon--warning`}),i.createElement("div",{className:Ve},I.length>0&&i.createElement(B.Selection,{readOnly:k,clearSelection:!h&&!k?se:lt,selectionCount:I.length,translateWithId:V,disabled:h}),i.createElement("button",K({type:"button",className:`${n}--list-box__field`,disabled:h,"aria-disabled":h||k,"aria-describedby":!v&&!f&&!F&&m?ae:void 0},re,{ref:j},Je),i.createElement("span",{id:Ue,className:`${n}--list-box__label`},x),i.createElement(B.MenuIcon,{isOpen:g,translateWithId:V})),de),i.createElement(B.Menu,Ne(),g&&O(le,q).map((e,b)=>{const r=I.filter($=>z($,e)).length>0,S=Re({item:e,"aria-selected":r}),T=p(e);return i.createElement(B.MenuItem,K({key:S.id,isActive:r,"aria-label":T,isHighlighted:Ke===b,title:T,disabled:S["aria-disabled"]},S),i.createElement("div",{className:`${n}--checkbox-wrapper`},i.createElement("span",{title:ye?T:void 0,className:`${n}--checkbox-label`,"data-contained-checkbox-state":r,id:`${S.id}__checkbox`},u?i.createElement(ze,K({key:S.id},e)):T)))})),Me&&i.createElement("span",{"aria-live":"assertive","aria-label":ge})),!v&&!f&&!F&&m&&i.createElement("div",{id:ae,className:je},m))});G.displayName="MultiSelect";G.propTypes={...ut,className:t.string,clearSelectionDescription:t.string,clearSelectionText:t.string,compareItems:t.func,direction:t.oneOf(["top","bottom"]),disabled:t.bool,downshiftProps:t.object,helperText:t.node,hideLabel:t.bool,id:t.string.isRequired,initialSelectedItems:t.array,invalid:t.bool,invalidText:t.node,itemToElement:t.func,itemToString:t.func,items:t.array.isRequired,label:t.node.isRequired,light:Ye(t.bool),locale:t.string,onChange:t.func,onMenuChange:t.func,open:t.bool,readOnly:t.bool,selectedItems:t.array,selectionFeedback:t.oneOf(["top","fixed","top-after-reopen"]),size:tt,slug:t.node,sortItems:t.func,titleText:t.node,translateWithId:t.func,type:t.oneOf(["default","inline"]),useTitleInItem:t.bool,warn:t.bool,warnText:t.node};var Lt=G;export{Lt as M};
