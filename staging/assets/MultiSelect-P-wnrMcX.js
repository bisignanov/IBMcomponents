import{O,u as st,f as lt,p as ot,q as rt,s as it,r as at,b as E,c as D,_ as K,e as ct,L as he,E as dt,S as ut,P as mt,j as pt}from"./floating-ui.react-C-lGofMW.js";import{u as ge,L as M,a as ft}from"./index-B1Zk_jvd.js";import{i as J}from"./index-CfyPTyT-.js";import{P as t}from"./index-Dk74W0Oi.js";import{r as c,R as i}from"./index-BwDkhjyp.js";import{m as ht}from"./mergeRefs-CTUecegF.js";import{F as gt}from"./FormContext-C7kRVu4t.js";import{n as It}from"./settings-CljJQLyl.js";import{b as bt,a as xt}from"./bucket-18-9qioxFta.js";const yt={compareItems:t.func,sortItems:t.func},St=(o,a,s)=>{let{locale:r}=s;return o.localeCompare(a,r,{numeric:!0})},Ct=(o,a)=>{let{selectedItems:s=[],itemToString:r,compareItems:u,locale:d="en"}=a;return o.sort((m,S)=>{const y=s.includes(m),p=s.includes(S);return y&&!p?-1:p&&!y?1:u(r(m),r(S),{locale:d})})};function G(o){let{isControlled:a,isMounted:s,onChangeHandlerControlled:r,onChangeHandlerUncontrolled:u,selectedItems:d}=o;a?s&&r&&r({selectedItems:d}):u(d)}function wt(o){let{disabled:a,onChange:s,initialSelectedItems:r=[],selectedItems:u}=o;const d=c.useRef(!1),m=c.useRef(s),[S,y]=c.useState(r),p=!!u,h=p?u:S,U=c.useCallback(F=>{if(a)return;let f;h.forEach((j,z)=>{J(j,F)&&(f=z)});let _;if(f===void 0){_=h.concat(F),G({isControlled:p,isMounted:d.current,onChangeHandlerControlled:m.current,onChangeHandlerUncontrolled:y,selectedItems:_});return}_=Ie(h,f),G({isControlled:p,isMounted:d.current,onChangeHandlerControlled:m.current,onChangeHandlerUncontrolled:y,selectedItems:_})},[a,p,h]),k=c.useCallback(()=>{a||G({isControlled:p,isMounted:d.current,onChangeHandlerControlled:m.current,onChangeHandlerUncontrolled:y,selectedItems:[]})},[a,p]);return c.useEffect(()=>{m.current=s},[s]),c.useEffect(()=>{d.current&&m.current&&!p&&m.current({selectedItems:h})},[p,h]),c.useEffect(()=>(d.current=!0,()=>{d.current=!1}),[]),{selectedItems:h,onItemChange:U,clearSelection:k}}class _t extends i.Component{constructor(a){super(a),O(this,"internalSetState",(s,r)=>this.setState(s,()=>{r&&r(),this.props.onChange&&this.props.onChange(this.state)})),O(this,"handleClearSelection",()=>{this.props.disabled||this.internalSetState({selectedItems:[]})}),O(this,"handleSelectItem",s=>{this.internalSetState(r=>({selectedItems:r.selectedItems.concat(s)}))}),O(this,"handleRemoveItem",s=>{this.internalSetState(r=>({selectedItems:Ie(r.selectedItems,s)}))}),O(this,"handleOnItemChange",s=>{if(this.props.disabled)return;const{selectedItems:r}=this.state;let u;if(r.forEach((d,m)=>{J(d,s)&&(u=m)}),u===void 0){this.handleSelectItem(s);return}this.handleRemoveItem(u)}),this.state={selectedItems:a.initialSelectedItems}}render(){const{children:a,render:s}=this.props,{selectedItems:r}=this.state,u={selectedItems:r,onItemChange:this.handleOnItemChange,clearSelection:this.handleClearSelection};return s!==void 0?s(u):a!==void 0?a(u):null}}O(_t,"propTypes",{children:t.func,disabled:t.bool,initialSelectedItems:t.array.isRequired,onChange:t.func,render:t.func});const Ie=(o,a)=>{const s=o.slice();return s.splice(a,1),s},{ItemClick:vt,ToggleButtonBlur:$t,ToggleButtonKeyDownArrowDown:Tt,ToggleButtonKeyDownArrowUp:Et,ToggleButtonKeyDownEnter:Ot,ToggleButtonKeyDownEscape:Pt,ToggleButtonKeyDownSpaceButton:At,ItemMouseMove:Dt,MenuMouseLeave:Mt,ToggleButtonClick:kt,ToggleButtonKeyDownPageDown:Ft,ToggleButtonKeyDownPageUp:Bt,FunctionSetHighlightedIndex:Nt}=ge.stateChangeTypes,Rt=o=>typeof o=="string"?o:typeof o=="number"?`${o}`:o!==null&&typeof o=="object"&&"label"in o&&typeof o.label=="string"?o.label:"",be=i.forwardRef((o,a)=>{var fe;let{autoAlign:s=!1,className:r,id:u,items:d,itemToElement:m,itemToString:S=Rt,titleText:y=!1,hideLabel:p,helperText:h,label:U,type:k="default",size:F,disabled:f=!1,initialSelectedItems:_=[],sortItems:j=Ct,compareItems:z=St,clearSelectionText:xe="To clear selection, press Delete or Backspace",clearAnnouncement:ye="all items have been cleared",clearSelectionDescription:Se="Total items selected: ",light:Ce,invalid:I,invalidText:we,warn:B,warnText:_e,useTitleInItem:ve,translateWithId:Q,downshiftProps:$e,open:v=!1,selectionFeedback:X="top-after-reopen",onChange:Te,onMenuChange:Y,direction:Z="bottom",selectedItems:Ee,readOnly:P,locale:Oe="en",slug:N}=o;const n=st(),{isFluid:R}=c.useContext(gt),ee=lt(),[Pe,te]=c.useState(!1),[ne,se]=c.useState(!1),[b,Ae]=c.useState(v||!1),[De,Me]=c.useState(v),[ke,Fe]=c.useState([]),[Be,le]=c.useState(!1),{selectedItems:H,onItemChange:oe,clearSelection:re}=wt({disabled:f,initialSelectedItems:_,onChange:Te,selectedItems:Ee}),{refs:A,floatingStyles:q,middlewareData:Ne}=ot(s?{placement:Z,strategy:"fixed",middleware:[rt({crossAxis:!1}),it({apply(e){let{rects:g,elements:l}=e;Object.assign(l.floating.style,{width:`${g.reference.width}px`})}})],whileElementsMounted:at}:{});c.useLayoutEffect(()=>{s&&Object.keys(q).forEach(e=>{A.floating.current&&(A.floating.current.style[e]=q[e])})},[s,q,A.floating,Ne,v]);const ie=c.useMemo(()=>d.filter(e=>{if(typeof e=="object"&&e!==null){for(const g in e)if(Object.hasOwn(e,g)&&e[g]===void 0)return!1}return!0}),[d]),Re={stateReducer:Xe,isOpen:b,itemToString:e=>Array.isArray(e)&&e.map(function(g){return S(g)}).join(", ")||"",selectedItem:H,items:ie,isItemDisabled(e,g){return e.disabled},...$e},{getToggleButtonProps:He,getLabelProps:Le,getMenuProps:Ke,getItemProps:Ue,selectedItem:je,highlightedIndex:ze,setHighlightedIndex:ae}=ge(Re),ce=He({onFocus:()=>{se(!0)},onBlur:()=>{se(!1)},onKeyDown:e=>{f||((E(e,he)||E(e,dt))&&!b&&(re(),e.stopPropagation()),!b&&E(e,he)&&x.length>0&&le(!0),(E(e,ut)||E(e,mt)||E(e,pt))&&!b&&(ae(0),le(!1),L(!0)))}}),W=ht(ce.ref,a),x=je,L=e=>{Ae(e),Y&&Y(e)};De!==v&&(L(v),Me(v));const w=k==="inline",de=!I&&B,qe=D(`${n}--multi-select__wrapper`,`${n}--list-box__wrapper`,r,{[`${n}--multi-select__wrapper--inline`]:w,[`${n}--list-box__wrapper--inline`]:w,[`${n}--multi-select__wrapper--inline--invalid`]:w&&I,[`${n}--list-box__wrapper--inline--invalid`]:w&&I,[`${n}--list-box__wrapper--fluid--invalid`]:R&&I,[`${n}--list-box__wrapper--fluid--focus`]:!b&&R&&Pe,[`${n}--list-box__wrapper--slug`]:N}),We=D(`${n}--label`,{[`${n}--label--disabled`]:f,[`${n}--visually-hidden`]:p}),ue=h?`multiselect-helper-text-${ee}`:void 0,Ve=`multiselect-field-label-${ee}`,Ge=D(`${n}--form__helper-text`,{[`${n}--form__helper-text--disabled`]:f}),Je=D(`${n}--multi-select`,{[`${n}--multi-select--invalid`]:I,[`${n}--multi-select--invalid--focused`]:I&&ne,[`${n}--multi-select--warning`]:de,[`${n}--multi-select--inline`]:w,[`${n}--multi-select--selected`]:x&&x.length>0,[`${n}--list-box--up`]:Z==="top",[`${n}--multi-select--readonly`]:P}),Qe=m,V={selectedItems:H,itemToString:S,compareItems:z,locale:Oe};X==="fixed"?V.selectedItems=[]:X==="top-after-reopen"&&(V.selectedItems=ke);function Xe(e,g){const{changes:l,props:C,type:$}=g,{highlightedIndex:T}=l;switch(l.isOpen&&!b&&Fe(H),$){case At:case Ot:if(l.selectedItem===void 0||Array.isArray(l.selectedItem))break;return oe(l.selectedItem),{...l,highlightedIndex:e.highlightedIndex};case $t:case Pt:L(!1);break;case kt:return L(l.isOpen||!1),{...l,highlightedIndex:H.length>0?0:void 0};case vt:return ae(l.selectedItem),oe(l.selectedItem),{...l,highlightedIndex:e.highlightedIndex};case Mt:return{...l,highlightedIndex:e.highlightedIndex};case Nt:return b?{...l,highlightedIndex:C.items.indexOf(T)}:{...l,highlightedIndex:0};case Tt:case Et:case Ft:case Bt:if(T>-1){const nt=document.querySelectorAll(`li.${n}--list-box__menu-item[role="option"]`);C.scrollIntoView(nt[T])}return T===-1?{...l,highlightedIndex:0}:l;case Dt:return{...l,highlightedIndex:e.highlightedIndex}}return l}const Ye=D(`${n}--list-box__field--wrapper`,{[`${n}--list-box__field--wrapper--input-focused`]:ne}),me=e=>{e.target.classList.contains(`${n}--tag__close-icon`)?te(!1):te(e.type==="focus")},Ze=P?{onClick:e=>{e.preventDefault(),W.current!==void 0&&W.current.focus()},onKeyDown:e=>{["ArrowDown","ArrowUp"," ","Enter"].includes(e.key)&&e.preventDefault()}}:{};let pe;N&&((fe=N.type)==null?void 0:fe.displayName)==="AILabel"&&(pe=i.cloneElement(N,{size:"mini"}));const et=x.length>0&&x.map(e=>e==null?void 0:e.text),tt=c.useMemo(()=>Ke({ref:s?A.setFloating:null}),[s]);return i.createElement("div",{className:qe},i.createElement("label",K({className:We},Le()),y&&y,x.length>0&&i.createElement("span",{className:`${n}--visually-hidden`},Se," ",x.length," ",et,",",xe)),i.createElement(M,{onFocus:R?me:void 0,onBlur:R?me:void 0,type:k,size:F,className:Je,disabled:f,light:Ce,invalid:I,invalidText:we,warn:B,warnText:_e,isOpen:b,id:u},I&&i.createElement(bt,{className:`${n}--list-box__invalid-icon`}),de&&i.createElement(xt,{className:`${n}--list-box__invalid-icon ${n}--list-box__invalid-icon--warning`}),i.createElement("div",{className:Ye,ref:s?A.setReference:null},x.length>0&&i.createElement(M.Selection,{readOnly:P,clearSelection:!f&&!P?re:It,selectionCount:x.length,translateWithId:Q,disabled:f}),i.createElement("button",K({type:"button",className:`${n}--list-box__field`,disabled:f,"aria-disabled":f||P,"aria-describedby":!w&&!I&&!B&&h?ue:void 0},ce,{ref:W},Ze),i.createElement("span",{id:Ve,className:`${n}--list-box__label`},U),i.createElement(M.MenuIcon,{isOpen:b,translateWithId:Q})),pe),i.createElement(M.Menu,tt,b&&j(ie,V).map((e,g)=>{const l=x.filter(T=>J(T,e)).length>0,C=Ue({item:e,"aria-selected":l}),$=S(e);return i.createElement(M.MenuItem,K({key:C.id,isActive:l,"aria-label":$,isHighlighted:ze===g,title:$,disabled:C["aria-disabled"]},C),i.createElement("div",{className:`${n}--checkbox-wrapper`},i.createElement("span",{title:ve?$:void 0,className:`${n}--checkbox-label`,"data-contained-checkbox-state":l,id:`${C.id}__checkbox`},m?i.createElement(Qe,K({key:C.id},e)):$)))})),Be&&i.createElement("span",{"aria-live":"assertive","aria-label":ye})),!w&&!I&&!B&&h&&i.createElement("div",{id:ue,className:Ge},h))});be.displayName="MultiSelect";be.propTypes={...yt,autoAlign:t.bool,className:t.string,clearSelectionDescription:t.string,clearSelectionText:t.string,compareItems:t.func,direction:t.oneOf(["top","bottom"]),disabled:t.bool,downshiftProps:t.object,helperText:t.node,hideLabel:t.bool,id:t.string.isRequired,initialSelectedItems:t.array,invalid:t.bool,invalidText:t.node,itemToElement:t.func,itemToString:t.func,items:t.array.isRequired,label:t.node.isRequired,light:ct(t.bool),locale:t.string,onChange:t.func,onMenuChange:t.func,open:t.bool,readOnly:t.bool,selectedItems:t.array,selectionFeedback:t.oneOf(["top","fixed","top-after-reopen"]),size:ft,slug:t.node,sortItems:t.func,titleText:t.node,translateWithId:t.func,type:t.oneOf(["default","inline"]),useTitleInItem:t.bool,warn:t.bool,warnText:t.node};export{be as M};
